generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      String // STUDENT, USTAZ, ADMIN
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Profile fields
  photoUrl       String?
  location       String?
  educationLevel String?
  bio            String?
  phoneNumber    String?

  // Student specific
  category        String?
  assignedUstazId Int?
  assignedUstaz   User?   @relation("UstazStudents", fields: [assignedUstazId], references: [id])
  students        User[]  @relation("UstazStudents")

  // Relations
  tasks            Task[]       @relation("StudentTasks")
  assignedTasks    Task[]       @relation("UstazTasks")
  attendance       Attendance[] @relation("StudentAttendance")
  markedAttendance Attendance[] @relation("UstazAttendance")
  feedbacks        Feedback[]
  complaints       Complaint[]
  timeSlots        TimeSlot[]
}

model Task {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  isCompleted Boolean  @default(false)
  date        DateTime @default(now())

  studentId Int
  student   User @relation("StudentTasks", fields: [studentId], references: [id])

  ustazId Int
  ustaz   User @relation("UstazTasks", fields: [ustazId], references: [id])
}

model Attendance {
  id      Int      @id @default(autoincrement())
  date    DateTime @default(now())
  status  String // PRESENT, ABSENT, LATE
  remarks String?

  studentId Int
  student   User @relation("StudentAttendance", fields: [studentId], references: [id])

  ustazId Int
  ustaz   User @relation("UstazAttendance", fields: [ustazId], references: [id])
}

model TimeSlot {
  id        Int     @id @default(autoincrement())
  day       String
  startTime String
  endTime   String
  isBooked  Boolean @default(false)

  ustazId Int
  ustaz   User @relation(fields: [ustazId], references: [id])
}

model Feedback {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())

  studentId Int
  student   User @relation(fields: [studentId], references: [id])
}

model Complaint {
  id        Int      @id @default(autoincrement())
  content   String
  status    String   @default("PENDING") // PENDING, RESOLVED
  createdAt DateTime @default(now())

  studentId Int
  student   User @relation(fields: [studentId], references: [id])
}
